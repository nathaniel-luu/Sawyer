<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>For Sawyer</title>

  <!-- Cinematic Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&display=swap" rel="stylesheet">

  <!-- Preload critical GIFs -->
  <link rel="preload" as="image" href="https://media.tenor.com/kMc91j5GxqQAAAAi/bubu-dudu-happy-birthday.gif">

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #f5f0eb;
      --bg-warm: #f0ebe4;
      --bg-cool: #edeae6;
      --ink: #2a2320;
      --ink-light: #6b5e54;
      --ink-faint: #a89e94;
      --accent: #4a8c3f;
      --accent-warm: #5ea352;
      --white: #faf8f5;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Cormorant Garamond', serif;
      background: var(--bg);
      color: var(--ink);
      overflow-x: hidden;
      min-height: 100dvh;
      -webkit-tap-highlight-color: transparent;
    }

    /* â”€â”€â”€ SCREENS â”€â”€â”€ */
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      padding: 2rem 1.5rem;
      position: relative;
      z-index: 1;
      text-align: center;
    }
    .screen.active { display: flex; }

    /* â”€â”€â”€ FADE â”€â”€â”€ */
    .fade-in {
      opacity: 0;
      transform: translateY(16px);
      animation: fadeIn 0.7s ease forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       INTRO SCREEN
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #intro {
      background: var(--bg-warm);
      gap: 2rem;
    }

    .intro-sticker {
      width: 240px;
      height: 240px;
      border-radius: 50%;
      overflow: hidden;
    }

    .intro-sticker img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .intro-greeting {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.8rem, 6vw, 3rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }

    .intro-sub {
      font-size: clamp(1.05rem, 3vw, 1.25rem);
      color: var(--ink-light);
      max-width: 360px;
      line-height: 1.7;
      font-weight: 300;
    }

    .btn-primary {
      background: var(--ink);
      color: var(--white);
      border: none;
      padding: 14px 44px;
      font-family: 'Cinzel', serif;
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    .btn-primary:hover { background: #3d3530; transform: translateY(-1px); }
    .btn-primary:active { transform: translateY(0); }

    /* â”€â”€â”€ LOADING FEELINGS â”€â”€â”€ */
    #loadingCanvas {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    .loading-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1.05rem, 3vw, 1.2rem);
      color: var(--ink);
      opacity: 0.85;
      transition: all 0.3s ease;
      min-height: 1.5em;
    }

    .loading-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.3rem, 5vw, 2rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }

    .loading-sub {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1rem, 3vw, 1.15rem);
      color: var(--ink);
      opacity: 0.7;
    }

    .loading-btn {
      background: none;
      border: 1.5px solid var(--accent);
      color: var(--ink);
      padding: 10px 20px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      letter-spacing: 0.06em;
      cursor: pointer;
      transition: background 0.3s, color 0.3s, transform 0.2s;
    }
    .loading-btn:hover {
      background: var(--accent);
      color: #fff;
      transform: translateY(-1px);
    }
    .loading-btn:active { transform: translateY(0); }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       CELEBRATION SCREEN
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #celebration {
      background: var(--bg-warm);
      gap: 1rem;
      padding: 1.5rem;
      justify-content: center;
      animation: celebGlow 3s ease-in-out infinite;
    }
    @keyframes celebGlow {
      0%, 100% { background: var(--bg-warm); }
      50% { background: #fdf5ed; }
    }

    .celeb-gifs {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      justify-content: center;
    }

    .celeb-sticker {
      width: 220px;
      height: 220px;
      overflow: hidden;
      border-radius: 50%;
      animation: celebFloat 3s ease-in-out infinite;
    }

    .celeb-sticker img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    @keyframes celebFloat {
      0%, 100% { transform: translateY(0) rotate(-1deg); }
      50% { transform: translateY(-6px) rotate(1deg); }
    }

    .celeb-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.5rem, 5.5vw, 2.5rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }

    .celeb-message {
      font-size: clamp(1rem, 2.8vw, 1.15rem);
      color: var(--ink-light);
      max-width: 380px;
      line-height: 1.7;
      font-weight: 300;
      text-align: center;
    }

    /* â”€â”€â”€ BOOKSHELF HUB â”€â”€â”€ */
    #adventure {
      background: var(--bg-cool);
      gap: 2rem;
    }

    .bookshelf-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.4rem, 5vw, 2.2rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }

    .bookshelf-sub {
      font-size: clamp(1rem, 3vw, 1.15rem);
      color: var(--ink-faint);
      font-style: italic;
      margin-top: -0.8rem;
    }

    .bookshelf {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: flex-end;
      justify-content: center;
      padding: 24px 16px 0;
    }

    .book {
      width: 95px;
      height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 10px;
      cursor: pointer;
      border: 1.5px solid var(--ink);
      position: relative;
      transition: all 0.3s ease;
      text-align: center;
    }
    .book::before {
      content: '';
      position: absolute;
      left: 4px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: var(--ink-faint);
      opacity: 0.5;
    }
    .book:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 20px rgba(42, 35, 32, 0.12);
    }

    .book-1 { background: var(--bg-warm); }
    .book-2 { background: #ede8e1; }
    .book-3 { background: #eae6df; }

    .book-number {
      font-family: 'Cinzel', serif;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      color: var(--ink-faint);
    }

    .book-title {
      font-family: 'Cinzel', serif;
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--ink);
      line-height: 1.4;
    }

    .book-desc {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.8rem;
      font-style: italic;
      color: var(--ink-faint);
      line-height: 1.3;
    }

    .shelf-line {
      width: calc(100% - 2rem);
      max-width: 420px;
      height: 3px;
      background: linear-gradient(to right, transparent, var(--ink-faint), var(--ink), var(--ink-faint), transparent);
      border-radius: 2px;
      margin-top: -1px;
    }

    /* â”€â”€â”€ BOOK SCREENS SHARED â”€â”€â”€ */
    .book-screen {
      background: var(--bg);
      gap: 1.5rem;
    }

    .book-screen-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.3rem, 5vw, 2rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }

    .btn-back {
      margin-top: 1rem;
      background: transparent;
      color: var(--ink-faint);
      border: 1px solid var(--ink-faint);
      padding: 10px 32px;
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      font-weight: 400;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-back:hover {
      color: var(--ink);
      border-color: var(--ink);
    }

    /* â”€â”€â”€ BOOK 1: THE LETTER â”€â”€â”€ */
    .letter-content {
      max-width: 440px;
      padding: 32px;
      border: 1px solid var(--ink-faint);
      background: var(--white);
      text-align: left;
    }

    .letter-salutation {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.2rem;
      font-style: italic;
      color: var(--ink);
      margin-bottom: 16px;
    }

    .letter-body {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.05rem;
      color: var(--ink);
      line-height: 2;
      white-space: pre-line;
    }

    .letter-sign {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-style: italic;
      color: var(--ink-light);
      margin-top: 24px;
      text-align: right;
    }

    /* â”€â”€â”€ LETTER LOCK â”€â”€â”€ */
    .letter-lock {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .letter-lock-hint {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-style: italic;
      color: var(--ink-faint);
    }

    .code-entry {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .code-input {
      width: 200px;
      padding: 10px 16px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      text-align: center;
      letter-spacing: 0.2em;
      color: var(--ink);
      background: transparent;
      border: none;
      border-bottom: 1.5px solid var(--ink-faint);
      outline: none;
      transition: border-color 0.3s;
    }
    .code-input::placeholder {
      color: var(--ink-faint);
      letter-spacing: 0.1em;
      font-style: italic;
    }
    .code-input:focus {
      border-bottom-color: var(--accent);
    }

    .code-error {
      font-size: 0.85rem;
      color: var(--accent);
      font-style: italic;
      opacity: 0;
      transition: opacity 0.3s;
      height: 1.2em;
    }
    .code-error.visible {
      opacity: 1;
    }

    .btn-start {
      margin-top: 8px;
      background: transparent;
      color: var(--ink);
      border: 1.5px solid var(--ink);
      padding: 12px 48px;
      font-family: 'Cinzel', serif;
      font-size: 0.8rem;
      font-weight: 500;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-start:hover {
      background: var(--ink);
      color: var(--white);
    }

    /* â”€â”€â”€ BOOK 2: SONGS â”€â”€â”€ */
    .songs-list {
      max-width: 380px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .song-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(168, 158, 148, 0.25);
      text-align: left;
      transition: background 0.2s;
    }
    .song-item:last-child { border-bottom: none; }
    .song-item:hover { background: rgba(168, 158, 148, 0.08); }
    .song-item.active {
      background: rgba(74, 140, 63, 0.08);
    }
    .song-item.active .song-num,
    .song-item.active .song-play-icon {
      color: var(--accent);
    }
    .song-item[data-track=""] {
      opacity: 0.35;
      pointer-events: none;
    }

    #book-songs {
      justify-content: flex-start;
      padding-top: 2.5rem;
      padding-bottom: 1.5rem;
      overflow-y: hidden;
    }
    #book-songs .songs-list {
      max-height: 40dvh;
      overflow-y: auto;
      border: 1px solid rgba(168, 158, 148, 0.2);
      scrollbar-width: thin;
      scrollbar-color: var(--ink-faint) transparent;
    }
    #book-songs .songs-list::-webkit-scrollbar { width: 4px; }
    #book-songs .songs-list::-webkit-scrollbar-thumb {
      background: var(--ink-faint); border-radius: 2px;
    }
    #book-songs .songs-list::-webkit-scrollbar-track { background: transparent; }

    .song-num {
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      font-weight: 400;
      color: var(--ink-faint);
      min-width: 20px;
      text-align: center;
    }

    .song-info {
      flex: 1;
    }

    .song-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.05rem;
      font-weight: 500;
      color: var(--ink);
      line-height: 1.3;
    }

    .song-artist {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.85rem;
      color: var(--ink-faint);
      font-style: italic;
    }

    .song-play-icon {
      font-size: 0.7rem;
      color: var(--ink-faint);
      transition: color 0.2s;
    }

    .songs-note {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.9rem;
      font-style: italic;
      color: var(--ink-faint);
      max-width: 300px;
      margin-top: 0.5rem;
    }

    .spotify-player {
      max-width: 380px;
      width: 100%;
      margin-top: 0.5rem;
    }

    /* â”€â”€â”€ BOOK 3: MEMORIES â”€â”€â”€ */
    #book-memories {
      justify-content: flex-start;
      padding-top: 3rem;
      padding-bottom: 2rem;
      overflow-y: auto;
    }

    .memories-sub {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.95rem;
      font-style: italic;
      color: var(--ink-faint);
      margin-bottom: 0.5rem;
    }

    .memories-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      max-width: 360px;
      width: 100%;
    }

    .memory-thumb {
      aspect-ratio: 1;
      overflow: hidden;
      border: 1px solid rgba(168, 158, 148, 0.25);
      cursor: pointer;
      transition: opacity 0.3s, transform 0.3s;
    }

    .memory-thumb:hover {
      opacity: 0.85;
      transform: scale(1.03);
    }

    .memory-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* â”€â”€â”€ MEMORY LIGHTBOX â”€â”€â”€ */
    .memory-lightbox {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(42, 35, 32, 0.92);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s;
    }
    .memory-lightbox.open {
      opacity: 1;
      pointer-events: auto;
    }

    .lb-close {
      position: absolute;
      top: 16px;
      right: 20px;
      background: none;
      border: none;
      font-size: 1.6rem;
      color: var(--white);
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s;
      z-index: 1001;
    }
    .lb-close:hover { opacity: 1; }

    .lb-img-wrap {
      max-width: 88vw;
      max-height: 55vh;
      overflow: hidden;
      border: 1px solid rgba(168, 158, 148, 0.3);
    }
    .lb-img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .lb-caption {
      max-width: 400px;
      margin-top: 16px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.05rem;
      font-style: italic;
      color: rgba(250, 248, 245, 0.75);
      line-height: 1.7;
      text-align: center;
    }

    .lb-nav {
      display: flex;
      gap: 32px;
      margin-top: 18px;
    }
    .lb-nav button {
      background: none;
      border: none;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: rgba(250, 248, 245, 0.5);
      cursor: pointer;
      transition: color 0.3s;
    }
    .lb-nav button:hover { color: var(--white); }

    .lb-counter {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.85rem;
      color: rgba(250, 248, 245, 0.35);
      margin-top: 8px;
    }

    /* â”€â”€â”€ SCREEN SHAKE â”€â”€â”€ */
    .shake { animation: shakeIt 0.35s ease-in-out; }
    @keyframes shakeIt {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      50% { transform: translateX(6px); }
      75% { transform: translateX(-4px); }
    }

    /* â”€â”€â”€ FLOATING PARTICLES BG â”€â”€â”€ */
    .particles-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      bottom: -20px;
      opacity: 0;
      animation: particleRise linear infinite;
    }

    @keyframes particleRise {
      0%   { opacity: 0; transform: translateY(0) translateX(0); }
      15%  { opacity: 0.4; }
      85%  { opacity: 0.2; }
      100% { opacity: 0; transform: translateY(-105dvh) translateX(var(--drift, 30px)); }
    }

    /* â”€â”€â”€ REDUCED MOTION â”€â”€â”€ */
    /* â”€â”€â”€ WATERPOLO GAME â”€â”€â”€ */
    #waterpolo-quest {
      background: var(--bg);
      gap: 0.8rem;
    }
    .wp-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.3rem, 5vw, 2rem);
      font-weight: 400;
      color: var(--ink);
      letter-spacing: 0.06em;
    }
    .wp-sub {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1rem, 3vw, 1.15rem);
      color: var(--ink);
      opacity: 0.7;
    }
    #waterpoloCanvas {
      border: 1.5px solid var(--ink-faint);
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      touch-action: none;
      cursor: pointer;
    }
    .wp-hud {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 340px;
      padding: 0 4px;
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.08em;
      color: var(--ink);
    }
    .wp-msg {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(1rem, 3vw, 1.15rem);
      color: var(--ink);
      opacity: 0;
      transition: opacity 0.6s ease;
      min-height: 1.5em;
    }
    .wp-msg.show { opacity: 1; }
    .wp-hint {
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.85rem;
      font-style: italic;
      color: var(--ink-faint);
    }

    /* â”€â”€â”€ SCREEN SHAKE â”€â”€â”€ */
    .shake { animation: shakeIt 0.35s ease-in-out; }
    @keyframes shakeIt {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      50% { transform: translateX(6px); }
      75% { transform: translateX(-4px); }
    }

    @media (prefers-reduced-motion: reduce) {
      .particle, .celeb-sticker { animation: none !important; }
      .fade-in { animation: none !important; opacity: 1; transform: none; }
    }
  </style>
</head>
<body>

  <!-- Subtle floating particles -->
  <div class="particles-bg" id="particlesBg"></div>

  <!-- ======= SCREEN 1 â€” INTRO ======= -->
  <section class="screen active" id="intro">
    <div class="intro-sticker">
      <img src="https://media.tenor.com/kMc91j5GxqQAAAAi/bubu-dudu-happy-birthday.gif"
           alt="Bubu and Dudu birthday">
    </div>
    <h1 class="intro-greeting fade-in">Happy Birthday My Sawyer</h1>
    <p class="intro-sub fade-in" style="animation-delay:0.3s">
      I wish you the happiest day of all &#x1F49A;
    </p>
    <button class="btn-primary fade-in" style="animation-delay:0.6s" onclick="goTo('waterpolo-quest')">
      Continue
    </button>
  </section>

  <!-- ======= SIDE QUEST â€” WATERPOLO ======= -->
  <section class="screen" id="waterpolo-quest">
    <h2 class="wp-title fade-in">side quest</h2>
    <p class="wp-sub fade-in" style="animation-delay:0.2s">score 3 goals â€” tap to shoot!</p>
    <div class="wp-hud fade-in" style="animation-delay:0.3s">
      <span id="wpGoals">goals: 0 / 3</span>
      <span id="wpShots">shots: 0</span>
    </div>
    <canvas class="fade-in" style="animation-delay:0.4s" id="waterpoloCanvas" width="340" height="260"></canvas>
    <p class="wp-hint fade-in" style="animation-delay:0.6s" id="wpHint">tap to shoot</p>
    <p class="wp-msg" id="wpMsg"></p>
    <button class="btn-primary" id="wpContinue" style="display:none" onclick="goTo('courage-quest')">Continue</button>
  </section>

  <!-- ======= SIDE QUEST â€” LOADING FEELINGS ======= -->
  <section class="screen" id="courage-quest">
    <h2 class="loading-title fade-in">hold on...</h2>
    <p class="loading-sub fade-in" style="animation-delay:0.2s">loading your birthday surprise</p>

    <canvas class="fade-in" style="animation-delay:0.4s" id="loadingCanvas" width="260" height="150"></canvas>

    <p class="loading-text fade-in" style="animation-delay:0.6s" id="loadingText">molding the play-doh...</p>

    <button class="loading-btn fade-in" style="animation-delay:0.8s" id="loadingBtn" onclick="advanceLoading()">tap to load</button>
  </section>

  <!-- ======= SCREEN â€” CELEBRATION ======= -->
  <section class="screen" id="celebration">
    <div class="celeb-gifs fade-in">
      <div class="celeb-sticker">
        <img src="https://media.tenor.com/kMc91j5GxqQAAAAi/bubu-dudu-happy-birthday.gif"
             alt="Bubu and Dudu birthday" loading="lazy">
      </div>
    </div>

    <h2 class="celeb-title fade-in">HAPPY BIRTHDAY SAWYER! &#x1F49A;</h2>

    <p class="celeb-message fade-in" style="animation-delay:0.3s">I made you some gifts...</p>

    <button class="btn-primary fade-in" style="animation-delay:0.6s" onclick="goTo('adventure')">open your gifts &rarr;</button>
  </section>

  <!-- ======= BOOKSHELF HUB ======= -->
  <section class="screen" id="adventure">
    <h2 class="bookshelf-title fade-in">your bookshelf</h2>
    <p class="bookshelf-sub fade-in" style="animation-delay:0.2s">pick one to open</p>

    <div class="bookshelf fade-in" style="animation-delay:0.4s">
      <div class="book book-1" onclick="goTo('book-letter')">
        <span class="book-number">I</span>
        <span class="book-title">The Letter</span>
        <span class="book-desc">words I've been saving</span>
      </div>
      <div class="book book-2" onclick="goTo('book-songs')">
        <span class="book-number">II</span>
        <span class="book-title">Our Songs</span>
        <span class="book-desc">the playlist</span>
      </div>
      <div class="book book-3" onclick="goTo('book-memories')">
        <span class="book-number">III</span>
        <span class="book-title">Memories</span>
        <span class="book-desc">our moments</span>
      </div>
    </div>
    <div class="shelf-line fade-in" style="animation-delay:0.4s"></div>
  </section>

  <!-- ======= BOOK 1 â€” THE LETTER ======= -->
  <section class="screen book-screen" id="book-letter">
    <h2 class="book-screen-title fade-in">The Letter</h2>

    <!-- Lock overlay -->
    <div class="letter-lock fade-in" style="animation-delay:0.3s" id="letterLock">
      <p class="letter-lock-hint">this letter is sealed</p>
      <div class="code-entry">
        <input type="text" id="letterCode" class="code-input" placeholder="enter the code" maxlength="10" autocomplete="off" spellcheck="false">
        <p class="code-error" id="letterCodeError">hmm, that's not it</p>
      </div>
      <button class="btn-start" onclick="tryLetterCode()">Unlock</button>
    </div>

    <!-- Hidden letter content -->
    <div class="letter-content fade-in" style="animation-delay:0.3s; display:none;" id="letterContent">
      <p class="letter-salutation">Dear Sawyer,</p>
      <p class="letter-body">Happy birthday to the most amazing person I know.

(Your letter will go here â€” Izzy will write it soon!)

I'm so grateful for you.</p>
      <p class="letter-sign">With all my love,<br>&mdash; Izzy</p>
    </div>

    <button class="btn-back fade-in" style="animation-delay:0.6s" onclick="goTo('adventure')">back to shelf</button>
  </section>

  <!-- ======= BOOK 2 â€” OUR SONGS ======= -->
  <section class="screen book-screen" id="book-songs">
    <h2 class="book-screen-title fade-in">Our Songs</h2>
    <p class="songs-note fade-in" style="animation-delay:0.2s">songs that remind me of us</p>

    <div class="songs-list fade-in" style="animation-delay:0.4s">
      <div class="song-item" data-track="" onclick="playSong(this)">
        <span class="song-num">01</span>
        <div class="song-info">
          <span class="song-name">Song Title</span>
          <span class="song-artist">Artist</span>
        </div>
        <span class="song-play-icon">&#9654;</span>
      </div>
      <div class="song-item" data-track="" onclick="playSong(this)">
        <span class="song-num">02</span>
        <div class="song-info">
          <span class="song-name">Song Title</span>
          <span class="song-artist">Artist</span>
        </div>
        <span class="song-play-icon">&#9654;</span>
      </div>
      <div class="song-item" data-track="" onclick="playSong(this)">
        <span class="song-num">03</span>
        <div class="song-info">
          <span class="song-name">Song Title</span>
          <span class="song-artist">Artist</span>
        </div>
        <span class="song-play-icon">&#9654;</span>
      </div>
    </div>

    <p class="songs-note fade-in" style="animation-delay:0.5s; margin-top:1rem;">(add Spotify track IDs to enable the player)</p>

    <div class="spotify-player fade-in" style="animation-delay:0.6s; display:none;" id="spotifyPlayer">
      <iframe
        id="spotifyEmbed"
        style="border-radius:12px"
        src=""
        width="100%"
        height="152"
        frameBorder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy">
      </iframe>
    </div>

    <button class="btn-back fade-in" style="animation-delay:0.6s" onclick="goTo('adventure')">back to shelf</button>
  </section>

  <!-- ======= BOOK 3 â€” MEMORIES ======= -->
  <section class="screen book-screen" id="book-memories">
    <h2 class="book-screen-title fade-in">Memories</h2>
    <p class="memories-sub fade-in" style="animation-delay:0.2s">tap a photo to relive it</p>

    <div class="memories-grid fade-in" style="animation-delay:0.4s">
      <div class="memory-thumb" onclick="openMemory(0)"><img src="photos/photo1.jpg" alt="Memory 1" loading="lazy"></div>
      <div class="memory-thumb" onclick="openMemory(1)"><img src="photos/photo2.jpg" alt="Memory 2" loading="lazy"></div>
      <div class="memory-thumb" onclick="openMemory(2)"><img src="photos/photo3.jpg" alt="Memory 3" loading="lazy"></div>
    </div>

    <button class="btn-back fade-in" style="animation-delay:0.6s" onclick="goTo('adventure')">back to shelf</button>
  </section>

  <!-- Memory lightbox -->
  <div class="memory-lightbox" id="memoryLightbox">
    <button class="lb-close" onclick="closeMemory()">&times;</button>
    <div class="lb-img-wrap"><img id="lbImg" src="" alt=""></div>
    <p class="lb-caption" id="lbCaption"></p>
    <div class="lb-nav">
      <button onclick="navMemory(-1)">&larr; prev</button>
      <button onclick="navMemory(1)">next &rarr;</button>
    </div>
    <p class="lb-counter" id="lbCounter"></p>
  </div>

  <script>
    // =======================================
    //  SUBTLE FLOATING PARTICLES
    // =======================================
    (function initParticles() {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) return;

      const bg = document.getElementById('particlesBg');
      const count = window.innerWidth < 600 ? 8 : 14;
      const chars = ['\u2727', '\u00B7', '\u2022', '\u2726'];

      for (let i = 0; i < count; i++) {
        const p = document.createElement('span');
        p.className = 'particle';
        p.textContent = chars[Math.floor(Math.random() * chars.length)];
        p.style.left = Math.random() * 100 + '%';
        p.style.fontSize = (8 + Math.random() * 10) + 'px';
        p.style.color = 'rgba(42,35,32,' + (0.08 + Math.random() * 0.1) + ')';
        p.style.animationDuration = (14 + Math.random() * 16) + 's';
        p.style.animationDelay = (Math.random() * 18) + 's';
        p.style.setProperty('--drift', (Math.random() * 60 - 30) + 'px');
        bg.appendChild(p);
      }
    })();

    // =======================================
    //  NAVIGATION
    // =======================================
    function goTo(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const target = document.getElementById(screenId);
      target.classList.add('active');

      target.querySelectorAll('.fade-in').forEach(el => {
        el.style.animation = 'none';
        el.offsetHeight;
        el.style.animation = '';
      });
      window.scrollTo(0, 0);

      // Initialize game scenes
      if (screenId === 'waterpolo-quest') setTimeout(initWaterpolo, 50);
      if (screenId === 'courage-quest') setTimeout(initLoadingFeelings, 50);
    }

    // =======================================
    //  CELEBRATION CONFETTI
    // =======================================
    function fireCelebration() {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) return;

      const heart = confetti.shapeFromText({ text: '\u2764\uFE0F', scalar: 2 });
      const cake = confetti.shapeFromText({ text: '\u{1F382}', scalar: 2 });
      const sparkle = confetti.shapeFromText({ text: '\u2728', scalar: 2 });
      const dragon = confetti.shapeFromText({ text: '\u{1F409}', scalar: 2 });
      const party = confetti.shapeFromText({ text: '\u{1F389}', scalar: 2 });
      const cols = ['#4CAF50', '#81C784', '#2E7D32', '#A5D6A7', '#FFD700', '#66BB6A'];
      const dfrm = true;

      // Phase 1: Big layered initial burst (3 layers for depth)
      setTimeout(() => {
        confetti({ particleCount: 40, spread: 26, startVelocity: 55, origin: { x: 0.5, y: 0.45 }, colors: cols, shapes: [heart, cake, 'circle'], scalar: 2.2, gravity: 0.8, disableForReducedMotion: dfrm });
        confetti({ particleCount: 30, spread: 60, origin: { x: 0.5, y: 0.45 }, colors: cols, shapes: [sparkle, dragon, 'circle'], scalar: 2, disableForReducedMotion: dfrm });
        confetti({ particleCount: 50, spread: 100, decay: 0.91, scalar: 1.5, origin: { x: 0.5, y: 0.45 }, colors: cols, shapes: [party, 'circle'], disableForReducedMotion: dfrm });
      }, 200);

      // Phase 2: Firework-style random bursts from different positions
      const fwEnd = Date.now() + 5000;
      const fwInterval = setInterval(() => {
        const timeLeft = fwEnd - Date.now();
        if (timeLeft <= 0) { clearInterval(fwInterval); return; }
        const count = Math.max(5, Math.floor(25 * (timeLeft / 5000)));
        confetti({ particleCount: count, startVelocity: 30, spread: 360, ticks: 60, origin: { x: 0.1 + Math.random() * 0.25, y: Math.random() * 0.4 }, colors: cols, shapes: [heart, sparkle, 'circle'], scalar: 1.8, gravity: 0.6, disableForReducedMotion: dfrm });
        confetti({ particleCount: count, startVelocity: 30, spread: 360, ticks: 60, origin: { x: 0.65 + Math.random() * 0.25, y: Math.random() * 0.4 }, colors: cols, shapes: [cake, dragon, 'circle'], scalar: 1.8, gravity: 0.6, disableForReducedMotion: dfrm });
      }, 300);

      // Phase 3: Sustained side launchers (both edges)
      const sideEnd = Date.now() + 4500;
      (function sideFrame() {
        confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0, y: 0.6 }, colors: cols, shapes: [heart, dragon, sparkle, 'circle'], scalar: 2, disableForReducedMotion: dfrm });
        confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1, y: 0.6 }, colors: cols, shapes: [heart, dragon, sparkle, 'circle'], scalar: 2, disableForReducedMotion: dfrm });
        if (Date.now() < sideEnd) requestAnimationFrame(sideFrame);
      })();

      // Phase 4: Surprise second burst (at 2.5s)
      setTimeout(() => {
        confetti({ particleCount: 60, spread: 120, startVelocity: 45, origin: { x: 0.3, y: 0.5 }, colors: cols, shapes: [heart, party, sparkle], scalar: 2.5, gravity: 0.7, disableForReducedMotion: dfrm });
        confetti({ particleCount: 60, spread: 120, startVelocity: 45, origin: { x: 0.7, y: 0.5 }, colors: cols, shapes: [cake, dragon, sparkle], scalar: 2.5, gravity: 0.7, disableForReducedMotion: dfrm });
      }, 2500);

      // Phase 5: Gentle heart rain (final fade)
      setTimeout(() => {
        const rainEnd = Date.now() + 3000;
        (function rainFrame() {
          confetti({ particleCount: 1, startVelocity: 0, ticks: 300, gravity: 0.4, drift: (Math.random() - 0.5) * 0.4, origin: { x: Math.random(), y: 0 }, colors: ['#4CAF50', '#2E7D32'], shapes: [heart], scalar: 2, disableForReducedMotion: dfrm });
          if (Date.now() < rainEnd) requestAnimationFrame(rainFrame);
        })();
      }, 4000);
    }

    // =======================================
    //  LETTER CODE LOCK
    // =======================================
    const LETTER_CODE = 'sawyer';
    const letterCodeInput = document.getElementById('letterCode');
    const letterCodeError = document.getElementById('letterCodeError');

    function tryLetterCode() {
      const entered = letterCodeInput.value.trim().toLowerCase();
      if (entered === LETTER_CODE) {
        document.getElementById('letterLock').style.display = 'none';
        document.getElementById('letterContent').style.display = '';
      } else {
        letterCodeError.classList.add('visible');
        letterCodeInput.style.borderBottomColor = '#4a8c3f';
        letterCodeInput.style.animation = 'none';
        void letterCodeInput.offsetHeight;
        letterCodeInput.style.animation = 'shakeIt 0.35s ease-in-out';
        setTimeout(() => {
          letterCodeError.classList.remove('visible');
          letterCodeInput.style.borderBottomColor = '';
          letterCodeInput.style.animation = '';
        }, 2000);
      }
    }

    letterCodeInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') tryLetterCode();
    });

    // =======================================
    //  MEMORY LIGHTBOX
    // =======================================
    const memories = [
      { src: 'photos/photo1.jpg', pos: 'center center', caption: 'Add caption here' },
      { src: 'photos/photo2.jpg', pos: 'center center', caption: 'Add caption here' },
      { src: 'photos/photo3.jpg', pos: 'center center', caption: 'Add caption here' },
    ];
    let currentMemory = 0;
    const lbEl = document.getElementById('memoryLightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCaption = document.getElementById('lbCaption');
    const lbCounter = document.getElementById('lbCounter');

    function showMemory(i) {
      currentMemory = i;
      const m = memories[i];
      lbImg.src = m.src;
      lbImg.style.objectPosition = m.pos;
      lbCaption.textContent = m.caption;
      lbCounter.textContent = (i + 1) + ' / ' + memories.length;
    }

    function openMemory(i) {
      showMemory(i);
      lbEl.classList.add('open');
    }

    function closeMemory() {
      lbEl.classList.remove('open');
    }

    function navMemory(dir) {
      let next = currentMemory + dir;
      if (next < 0) next = memories.length - 1;
      if (next >= memories.length) next = 0;
      showMemory(next);
    }

    // Close on background click
    lbEl.addEventListener('click', (e) => {
      if (e.target === lbEl) closeMemory();
    });

    // =======================================
    //  SPOTIFY PLAYER
    // =======================================
    function playSong(el) {
      const trackId = el.dataset.track;
      if (!trackId) return;

      // Update active state
      document.querySelectorAll('.song-item').forEach(s => s.classList.remove('active'));
      el.classList.add('active');

      // Show and swap Spotify embed src
      const player = document.getElementById('spotifyPlayer');
      player.style.display = '';
      const embed = document.getElementById('spotifyEmbed');
      const newSrc = 'https://open.spotify.com/embed/track/' + trackId + '?utm_source=generator&theme=0';
      if (embed.src !== newSrc) {
        embed.src = newSrc;
      }
    }

    // =======================================
    //  WATERPOLO â€” PENALTY SHOOTOUT GAME
    // =======================================
    let wpState = null;
    let wpAnimId = null;

    const wpGoalMsgs = [
      'SPLAAASH!',
      'what a shot!',
      'too easy ðŸ˜¤',
      'nothing but net!',
      'absolute rocket ðŸš€',
      'the crowd goes wild!',
    ];

    function initWaterpolo() {
      const cvs = document.getElementById('waterpoloCanvas');
      if (!cvs) return;
      const ctx = cvs.getContext('2d');
      ctx.imageSmoothingEnabled = false;
      const W = cvs.width, H = cvs.height;
      const bp = 4; // pixel size

      if (wpAnimId) cancelAnimationFrame(wpAnimId);

      wpState = {
        phase: 'aiming', // aiming, shooting, goal, saved, won
        goals: 0, shots: 0, frame: 0,
        // Goal frame
        goalX: 45, goalY: 30, goalW: 250, goalH: 100,
        // Goalie
        gkX: W / 2, gkDir: 1, gkSpeed: 1.2,
        gkW: 36, gkH: 44,
        // Aim marker
        aimX: W / 2, aimDir: 1, aimSpeed: 2.5,
        // Ball
        ballX: W / 2, ballY: H - 40,
        ballTargetX: 0, ballTargetY: 0,
        ballProgress: 0,
        ballStartX: 0, ballStartY: 0,
        // Splash particles
        splashes: [],
        // Message timer
        msgTimer: 0,
        // Difficulty (goalie gets faster each goal)
        difficulty: 0,
      };

      document.getElementById('wpGoals').textContent = 'goals: 0 / 3';
      document.getElementById('wpShots').textContent = 'shots: 0';
      document.getElementById('wpHint').style.display = '';
      document.getElementById('wpHint').textContent = 'tap to shoot';
      document.getElementById('wpMsg').classList.remove('show');
      document.getElementById('wpMsg').textContent = '';
      document.getElementById('wpContinue').style.display = 'none';

      // Click handler
      cvs.onclick = function() {
        if (!wpState) return;
        if (wpState.phase === 'aiming') {
          // Shoot!
          wpState.phase = 'shooting';
          wpState.shots++;
          wpState.ballStartX = wpState.ballX;
          wpState.ballStartY = wpState.ballY;
          wpState.ballTargetX = wpState.aimX;
          wpState.ballTargetY = wpState.goalY + 60;
          wpState.ballProgress = 0;
          document.getElementById('wpHint').style.display = 'none';
          document.getElementById('wpShots').textContent = 'shots: ' + wpState.shots;
        }
      };

      function drawWaterpoloFrame() {
        const s = wpState;
        if (!s) return;
        s.frame++;
        ctx.clearRect(0, 0, W, H);

        // === BACKGROUND â€” Pool water ===
        // Deep water gradient
        const waterGrad = ctx.createLinearGradient(0, 0, 0, H);
        waterGrad.addColorStop(0, '#4a90b8');
        waterGrad.addColorStop(0.3, '#3d7fa8');
        waterGrad.addColorStop(1, '#2d6a90');
        ctx.fillStyle = waterGrad;
        ctx.fillRect(0, 0, W, H);

        // Pool lane lines (horizontal)
        ctx.fillStyle = 'rgba(255,255,255,0.12)';
        for (let ly = 0; ly < H; ly += 40) {
          ctx.fillRect(0, ly, W, bp);
        }
        // Lane rope floats (colored dots on lane lines)
        const ropeColors = ['#e04040', '#ffffff', '#e04040', '#3060c0', '#ffffff'];
        for (let ly = 0; ly < H; ly += 40) {
          for (let lx = 0; lx < W; lx += 20) {
            ctx.fillStyle = ropeColors[Math.floor((lx + ly) / 20) % ropeColors.length];
            ctx.globalAlpha = 0.25;
            ctx.fillRect(lx, ly, bp * 2, bp);
            ctx.globalAlpha = 1;
          }
        }

        // Water wave effect (subtle sine ripples)
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        for (let wy = 0; wy < H; wy += 12) {
          const waveOffset = Math.sin(s.frame * 0.03 + wy * 0.1) * 8;
          ctx.fillRect(waveOffset, wy, W, 2);
        }

        // === GOAL FRAME ===
        const gx = s.goalX, gy = s.goalY, gw = s.goalW, gh = s.goalH;
        // Goal shadow
        ctx.fillStyle = 'rgba(0,0,0,0.15)';
        ctx.fillRect(gx + 4, gy + 4, gw, gh);
        // Net mesh (behind everything)
        ctx.fillStyle = 'rgba(255,255,255,0.15)';
        for (let ny = gy + bp * 2; ny < gy + gh; ny += 8) {
          ctx.fillRect(gx + bp * 2, ny, gw - bp * 4, 1);
        }
        for (let nx = gx + bp * 2; nx < gx + gw; nx += 8) {
          ctx.fillRect(nx, gy + bp * 2, 1, gh - bp * 2);
        }
        // Goal posts (white, thick)
        ctx.fillStyle = '#f0f0f0';
        ctx.fillRect(gx, gy, bp * 2, gh); // left post
        ctx.fillRect(gx + gw - bp * 2, gy, bp * 2, gh); // right post
        ctx.fillRect(gx, gy, gw, bp * 2); // crossbar
        // Post highlights
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(gx + 1, gy + 1, bp, gh - 2);
        ctx.fillRect(gx + gw - bp * 2 + 1, gy + 1, bp, gh - 2);
        ctx.fillRect(gx + 1, gy + 1, gw - 2, bp);
        // Water line at goal base
        ctx.fillStyle = 'rgba(255,255,255,0.2)';
        ctx.fillRect(gx, gy + gh - bp, gw, bp);

        // === GOALIE ===
        // Goalie moves back and forth inside the goal
        if (s.phase === 'aiming' || s.phase === 'shooting') {
          const gkSpeed = s.gkSpeed + s.difficulty * 0.4;
          s.gkX += s.gkDir * gkSpeed;
          const gkLeft = gx + bp * 3 + s.gkW / 2;
          const gkRight = gx + gw - bp * 3 - s.gkW / 2;
          if (s.gkX > gkRight) { s.gkX = gkRight; s.gkDir = -1; }
          if (s.gkX < gkLeft) { s.gkX = gkLeft; s.gkDir = 1; }
        }
        // Draw goalie (pixel art character in water)
        const gkDrawX = s.gkX - s.gkW / 2;
        const gkDrawY = gy + gh - s.gkH - bp * 2;
        // Body (treading water bob)
        const gkBob = Math.sin(s.frame * 0.08) * 2;
        // Cap (green â€” waterpolo cap)
        ctx.fillStyle = '#2E7D32';
        ctx.fillRect(gkDrawX + 6, gkDrawY + gkBob, 24, bp * 2);
        ctx.fillStyle = '#4CAF50';
        ctx.fillRect(gkDrawX + 8, gkDrawY + gkBob - bp, 20, bp);
        // Head
        ctx.fillStyle = '#f0d8b8';
        ctx.fillRect(gkDrawX + 8, gkDrawY + bp * 2 + gkBob, 20, 12);
        // Eyes
        ctx.fillStyle = '#2a2320';
        ctx.fillRect(gkDrawX + 12, gkDrawY + bp * 2 + 4 + gkBob, bp, bp);
        ctx.fillRect(gkDrawX + 22, gkDrawY + bp * 2 + 4 + gkBob, bp, bp);
        // Arms (out to sides, treading)
        const armWave = Math.sin(s.frame * 0.1) * 3;
        ctx.fillStyle = '#f0d8b8';
        ctx.fillRect(gkDrawX - 2, gkDrawY + bp * 3 + 4 + armWave + gkBob, 10, bp * 2);
        ctx.fillRect(gkDrawX + 28, gkDrawY + bp * 3 + 4 - armWave + gkBob, 10, bp * 2);
        // Water splash around goalie
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fillRect(gkDrawX - 4, gkDrawY + bp * 5 + gkBob, s.gkW + 8, bp);

        // === AIM MARKER (sweeping indicator) ===
        if (s.phase === 'aiming') {
          s.aimX += s.aimDir * s.aimSpeed;
          const aimLeft = gx + bp * 4;
          const aimRight = gx + gw - bp * 4;
          if (s.aimX > aimRight) { s.aimX = aimRight; s.aimDir = -1; }
          if (s.aimX < aimLeft) { s.aimX = aimLeft; s.aimDir = 1; }
          // Draw aim crosshair
          const aimY = gy + gh - 20;
          ctx.fillStyle = 'rgba(255, 80, 80, 0.7)';
          // Vertical line
          ctx.fillRect(s.aimX - 1, aimY - 12, 2, 24);
          // Horizontal line
          ctx.fillRect(s.aimX - 12, aimY - 1, 24, 2);
          // Circle
          ctx.strokeStyle = 'rgba(255, 80, 80, 0.6)';
          ctx.lineWidth = 1.5;
          ctx.beginPath();
          ctx.arc(s.aimX, aimY, 8, 0, Math.PI * 2);
          ctx.stroke();
        }

        // === BALL ===
        if (s.phase === 'aiming') {
          // Ball at bottom, ready to shoot
          drawWpBall(ctx, s.ballX, s.ballY, bp);
        } else if (s.phase === 'shooting') {
          // Animate ball flying toward target
          s.ballProgress += 0.04;
          if (s.ballProgress >= 1) {
            s.ballProgress = 1;
            // Check if goal or save
            const dx = Math.abs(s.ballTargetX - s.gkX);
            if (dx > s.gkW / 2 + 4) {
              // GOAL!
              s.goals++;
              s.difficulty = s.goals;
              s.phase = 'goal';
              s.msgTimer = 90;
              // Splash effect at target
              for (let i = 0; i < 12; i++) {
                s.splashes.push({
                  x: s.ballTargetX + (Math.random() - 0.5) * 20,
                  y: s.ballTargetY + (Math.random() - 0.5) * 10,
                  vx: (Math.random() - 0.5) * 4,
                  vy: -Math.random() * 3 - 1,
                  life: 20 + Math.floor(Math.random() * 15),
                });
              }
              document.getElementById('wpGoals').textContent = 'goals: ' + s.goals + ' / 3';
              const msgEl = document.getElementById('wpMsg');
              msgEl.textContent = wpGoalMsgs[Math.floor(Math.random() * wpGoalMsgs.length)];
              msgEl.classList.add('show');
              // Check win
              if (s.goals >= 3) {
                s.phase = 'won';
                msgEl.textContent = 'hat trick! waterpolo king ðŸ‘‘';
                document.getElementById('wpContinue').style.display = '';
              }
            } else {
              // SAVED
              s.phase = 'saved';
              s.msgTimer = 60;
              // Screen shake
              const screen = document.getElementById('waterpolo-quest');
              screen.classList.remove('shake');
              void screen.offsetHeight;
              screen.classList.add('shake');
              const msgEl = document.getElementById('wpMsg');
              msgEl.textContent = 'saved! try again...';
              msgEl.classList.add('show');
            }
          }
          // Ball position (quadratic arc)
          const t = s.ballProgress;
          const arcHeight = -120 * t * (1 - t); // parabolic arc
          const curX = s.ballStartX + (s.ballTargetX - s.ballStartX) * t;
          const curY = s.ballStartY + (s.ballTargetY - s.ballStartY) * t + arcHeight;
          // Ball grows slightly as it "approaches" the goal (perspective)
          drawWpBall(ctx, curX, curY, bp * (1 - t * 0.3));
        }

        // === SPLASH PARTICLES ===
        s.splashes.forEach(sp => {
          sp.x += sp.vx;
          sp.y += sp.vy;
          sp.vy += 0.15;
          sp.life--;
          const alpha = Math.max(0, sp.life / 30);
          ctx.globalAlpha = alpha;
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(sp.x, sp.y, bp, bp);
          ctx.fillRect(sp.x + bp, sp.y - bp, bp * 0.5, bp * 0.5);
        });
        ctx.globalAlpha = 1;
        s.splashes = s.splashes.filter(sp => sp.life > 0);

        // === GOAL SCORE DISPLAY (pixel hearts/balls at top) ===
        for (let h = 0; h < 3; h++) {
          const hx = W / 2 - 28 + h * 22;
          const filled = h < s.goals;
          ctx.fillStyle = filled ? '#4CAF50' : 'rgba(255,255,255,0.25)';
          // Mini ball
          ctx.beginPath();
          ctx.arc(hx + 6, 14, 6, 0, Math.PI * 2);
          ctx.fill();
          if (filled) {
            ctx.fillStyle = '#81C784';
            ctx.beginPath();
            ctx.arc(hx + 4, 12, 2, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        // === STATE TRANSITIONS ===
        if (s.phase === 'goal' || s.phase === 'saved') {
          s.msgTimer--;
          if (s.msgTimer <= 0) {
            s.phase = 'aiming';
            s.ballX = W / 2;
            s.ballY = H - 40;
            s.ballProgress = 0;
            document.getElementById('wpMsg').classList.remove('show');
            document.getElementById('wpHint').style.display = '';
            document.getElementById('wpHint').textContent = 'tap to shoot';
          }
        }

        wpAnimId = requestAnimationFrame(drawWaterpoloFrame);
      }

      drawWaterpoloFrame();
    }

    function drawWpBall(ctx, x, y, p) {
      // Waterpolo ball â€” yellow/white sphere with cross pattern
      const r = p * 3;
      // Ball body
      ctx.fillStyle = '#f5e060';
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fill();
      // Highlight
      ctx.fillStyle = '#f8eca0';
      ctx.beginPath();
      ctx.arc(x - r * 0.25, y - r * 0.25, r * 0.45, 0, Math.PI * 2);
      ctx.fill();
      // Cross stripes
      ctx.strokeStyle = 'rgba(180,140,40,0.5)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(x - r, y); ctx.lineTo(x + r, y);
      ctx.moveTo(x, y - r); ctx.lineTo(x, y + r);
      ctx.stroke();
      // Outline
      ctx.strokeStyle = 'rgba(160,120,20,0.4)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.stroke();
    }

    // =======================================
    //  LOADING FEELINGS â€” FAKE LOADING SCREEN
    // =======================================

    // Minimal dudu sprite for the loading scene character
    const loadingChar = {
      c: { 1:'#B8860B', 2:'#7a5a0a', 3:'#2a2320', 4:'#FFB6C1' },
      f: [[
        [0,0,2,2,0,0,2,2,0,0],[0,2,2,2,2,2,2,2,2,0],
        [0,1,1,1,1,1,1,1,1,0],[1,1,3,3,1,1,3,3,1,1],
        [1,1,1,1,1,1,1,1,1,1],[1,4,1,1,1,1,1,1,4,1],
        [0,1,1,1,3,1,1,1,1,0],[0,0,1,1,1,1,1,1,0,0],
        [0,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,0],
        [0,0,1,1,0,0,1,1,0,0],[0,0,1,1,0,0,1,1,0,0]
      ],[
        [0,0,2,2,0,0,2,2,0,0],[0,2,2,2,2,2,2,2,2,0],
        [0,1,1,1,1,1,1,1,1,0],[1,1,3,3,1,1,3,3,1,1],
        [1,1,1,1,1,1,1,1,1,1],[1,4,1,1,1,1,1,1,4,1],
        [0,1,1,1,3,1,1,1,1,0],[0,0,1,1,1,1,1,1,0,0],
        [0,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,0],
        [0,1,1,0,0,0,0,1,1,0],[1,1,0,0,0,0,0,0,1,1]
      ]]
    };

    let loadStep = 0;
    const maxLoadSteps = 6;
    let loadSparkles = [];
    let loadBounce = 0;
    let loadBarAnim = 0;
    let loadAnimFrame = null;
    const loadingMessages = [
      'molding the play-doh...',
      'summoning dragons...',
      'arranging funko pops...',
      'queuing the movie marathon...',
      'scoring the waterpolo goal...',
      'compiling birthday wishes...',
    ];

    function initLoadingFeelings() {
      loadStep = 0;
      loadBounce = 0;
      loadSparkles = [];
      loadBarAnim = 0;
      if (loadAnimFrame) cancelAnimationFrame(loadAnimFrame);
      const btn = document.getElementById('loadingBtn');
      btn.style.display = '';
      btn.textContent = 'tap to load';
      document.getElementById('loadingText').textContent = 'molding the play-doh...';
      document.getElementById('loadingText').style.fontWeight = '';
      animateLoadingScene();
    }

    function animateLoadingScene() {
      drawLoadingScene();
      loadAnimFrame = requestAnimationFrame(animateLoadingScene);
    }

    function drawLoadingScene() {
      const cvs = document.getElementById('loadingCanvas');
      if (!cvs) return;
      const ctx = cvs.getContext('2d');
      const W = cvs.width, H = cvs.height;
      ctx.clearRect(0, 0, W, H);

      // Ground
      ctx.fillStyle = '#d4c4b0';
      ctx.fillRect(0, 130, W, 20);
      ctx.fillStyle = '#c8b8a4';
      for (let i = 0; i < 14; i++) ctx.fillRect(5 + i * 19, 133, 4, 4);

      // Character (left side, scale 7) using loadingChar
      const ch = loadingChar;
      const frame = ch.f[loadStep % ch.f.length];
      const cs = 7;
      const charX = 20;
      const charY = 58 - loadBounce;
      for (let r = 0; r < frame.length; r++)
        for (let c = 0; c < frame[r].length; c++) {
          const v = frame[r][c];
          if (v && ch.c[v]) {
            ctx.fillStyle = ch.c[v];
            ctx.fillRect(charX + c * cs, charY + r * cs, cs, cs);
          }
        }

      // Animated ellipsis dots above character (thinking...)
      const dotTime = Date.now() / 400;
      for (let d = 0; d < 3; d++) {
        const alpha = (Math.sin(dotTime + d * 1.2) + 1) / 2;
        ctx.globalAlpha = 0.3 + alpha * 0.7;
        ctx.fillStyle = '#4a8c3f';
        ctx.fillRect(charX + 30 + d * 10, charY - 12, 5, 5);
      }
      ctx.globalAlpha = 1;

      // Loading bar (retro pixel style)
      const mx = 108, my = 70, mw = 130, mh = 22;

      // Outer border (double pixel border like retro games)
      ctx.fillStyle = '#5c3d22';
      ctx.fillRect(mx - 4, my - 4, mw + 8, mh + 8);
      ctx.fillStyle = '#8a7e70';
      ctx.fillRect(mx - 2, my - 2, mw + 4, mh + 4);

      // Background
      ctx.fillStyle = '#e8e0d4';
      ctx.fillRect(mx, my, mw, mh);

      // Fill â€” smooth animated fill toward target
      const targetFill = (loadStep / maxLoadSteps) * mw;
      // Snap to full when complete, otherwise ease
      if (loadStep >= maxLoadSteps) {
        loadBarAnim += (targetFill - loadBarAnim) * 0.15;
        if (targetFill - loadBarAnim < 1) loadBarAnim = targetFill;
      } else {
        loadBarAnim += (targetFill - loadBarAnim) * 0.08;
      }
      const fillW = Math.min(loadBarAnim, mw);

      // Gradient fill using pixel blocks (retro style)
      const blockSize = 4;
      const totalBlocks = Math.ceil(mw / blockSize);
      const filledPx = Math.round(fillW);
      for (let b = 0; b < totalBlocks; b++) {
        const bx = b * blockSize;
        if (bx >= filledPx) break;
        const bw = Math.min(blockSize, filledPx - bx);
        const progress = b / totalBlocks;
        // Green gradient (soft sage to vibrant green)
        const r = Math.floor(80 - progress * 20);
        const g = Math.floor(150 + progress * 50);
        const bl = Math.floor(70 - progress * 10);
        ctx.fillStyle = `rgb(${Math.max(r,50)},${Math.min(g,200)},${Math.max(bl,55)})`;
        ctx.fillRect(mx + bx, my, bw, mh);
      }

      // Scan line effect (subtle horizontal lines for retro feel)
      ctx.fillStyle = 'rgba(0,0,0,0.06)';
      for (let y = my; y < my + mh; y += 4) {
        ctx.fillRect(mx, y, fillW, 1);
      }

      // Animated shimmer on the fill edge
      if (fillW > 8 && loadStep < maxLoadSteps) {
        const shimX = mx + fillW - 6;
        const shimAlpha = (Math.sin(Date.now() / 200) + 1) / 4;
        ctx.globalAlpha = shimAlpha;
        ctx.fillStyle = '#fff';
        ctx.fillRect(shimX, my + 2, 4, mh - 4);
        ctx.globalAlpha = 1;
      }

      // Percentage text
      const pct = Math.min(Math.floor((loadStep / maxLoadSteps) * 100), 100);
      ctx.fillStyle = '#5c3d22';
      ctx.font = '600 10px monospace';
      ctx.textAlign = 'center';
      ctx.fillText(pct + '%', mx + mw / 2, my - 8);

      // Sparkles
      loadSparkles.forEach(s => {
        const alpha = 1 - s.age / 20;
        if (alpha <= 0) return;
        ctx.globalAlpha = alpha;
        ctx.fillStyle = s.color;
        ctx.fillRect(s.x, s.y, 3, 3);
        ctx.fillRect(s.x - 3, s.y, 3, 3);
        ctx.fillRect(s.x + 3, s.y, 3, 3);
        ctx.fillRect(s.x, s.y - 3, 3, 3);
        ctx.fillRect(s.x, s.y + 3, 3, 3);
      });
      ctx.globalAlpha = 1;

      // Update sparkle physics
      loadSparkles.forEach(s => { s.y -= 0.8; s.age++; });
      loadSparkles = loadSparkles.filter(s => s.age < 20);

      // Full bar glow effect
      if (loadStep >= maxLoadSteps) {
        const glowAlpha = (Math.sin(Date.now() / 300) + 1) / 6;
        ctx.globalAlpha = glowAlpha;
        ctx.fillStyle = '#4CAF50';
        ctx.fillRect(mx - 2, my - 2, mw + 4, mh + 4);
        ctx.globalAlpha = 1;
      }
    }

    function advanceLoading() {
      if (loadStep >= maxLoadSteps) return;
      loadStep++;

      // Character bounce
      loadBounce = 8;
      setTimeout(() => { loadBounce = 4; }, 80);
      setTimeout(() => { loadBounce = 0; }, 160);

      // Spawn sparkles at fill edge
      const sparkColors = ['#FFD700', '#4CAF50', '#81C784'];
      const fillX = 108 + (loadStep / maxLoadSteps) * 130;
      for (let i = 0; i < 4; i++) {
        loadSparkles.push({
          x: fillX + Math.random() * 12 - 6,
          y: 60 + Math.random() * 20,
          age: 0,
          color: sparkColors[i % sparkColors.length],
        });
      }

      // Update text
      const textEl = document.getElementById('loadingText');
      const btn = document.getElementById('loadingBtn');
      if (loadStep < maxLoadSteps) {
        textEl.textContent = loadingMessages[loadStep];
        if (loadStep === maxLoadSteps - 1) btn.textContent = 'one more...';
      } else {
        textEl.textContent = 'ready. happy birthday!';
        textEl.style.fontWeight = '600';
        btn.style.display = 'none';
        // Let the full bar glow for a moment, then transition
        setTimeout(() => {
          if (loadAnimFrame) cancelAnimationFrame(loadAnimFrame);
          goTo('celebration');
          fireCelebration();
        }, 1800);
      }
    }
  </script>
</body>
</html>
